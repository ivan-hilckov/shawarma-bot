# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é - Shawarma Bot

**–í–µ—Ä—Å–∏—è:** 3.0.0  
**–î–∞—Ç–∞:** 2025-01-03  
**–ê–≤—Ç–æ—Ä:** –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jest –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å TypeScript. –ó–∞ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∞—Å—å —Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–∫–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–µ–±—É–µ—Ç —á–µ—Ç–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
__tests__/
‚îú‚îÄ‚îÄ setupJest.ts              # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Jest
‚îú‚îÄ‚îÄ test-utils.ts             # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ api/                      # API Route —Ç–µ—Å—Ç—ã (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ)
‚îÇ   ‚îú‚îÄ‚îÄ cart.test.ts          # –¢–µ—Å—Ç—ã Cart API —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ orders.test.ts        # –¢–µ—Å—Ç—ã Orders API —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ menu.test.ts          # –¢–µ—Å—Ç—ã Menu API
‚îÇ   ‚îú‚îÄ‚îÄ health.test.ts        # –¢–µ—Å—Ç—ã Health API
‚îÇ   ‚îî‚îÄ‚îÄ *-schemas.test.ts     # –¢–µ—Å—Ç—ã Zod —Å—Ö–µ–º
‚îú‚îÄ‚îÄ unit/                     # Unit —Ç–µ—Å—Ç—ã (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
‚îÇ   ‚îú‚îÄ‚îÄ api-client.test.ts    # –¢–µ—Å—Ç—ã HTTP –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ cartApiService.test.ts # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –∫–æ—Ä–∑–∏–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ orderService.test.ts  # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–∫–∞–∑–æ–≤
‚îî‚îÄ‚îÄ [—Ñ–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤]            # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jest

### jest.config.js

```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  setupFilesAfterEnv: ['<rootDir>/__tests__/setupJest.ts'],
  testPathIgnorePatterns: [
    '/node_modules/',
    '__tests__/setupJest.ts', // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    '__tests__/test-utils.ts', // –£—Ç–∏–ª–∏—Ç—ã –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º
  ],
  testTimeout: 10000,
  clearMocks: true,
  restoreMocks: true,
};
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```bash
NODE_ENV=test           # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
DEBUG_TESTS=1          # –í–∫–ª—é—á–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
JEST_CURRENT_TEST      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Jest
```

## üîß –°–∏—Å—Ç–µ–º–∞ –º–æ–∫–æ–≤

### üö® –ü–†–û–ë–õ–ï–ú–´ –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ä–µ—à–∏–ª–∏

#### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–Ω–∏ –∏ —Ç–µ –∂–µ –º–æ–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å –≤:

- `setupJest.ts` (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ)
- `apiSetupJest.ts` (–¥–ª—è API —Ç–µ—Å—Ç–æ–≤)
- –õ–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö —Ç–µ—Å—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –≤ –∫–∞–∂–¥–æ–º —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ.

#### 2. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–æ–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –∏–∑ `setupJest.ts` –º–µ—à–∞–ª–∏ unit —Ç–µ—Å—Ç–∞–º.

**–†–µ—à–µ–Ω–∏–µ:** Unit —Ç–µ—Å—Ç—ã –æ—Ç–∫–ª—é—á–∞—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ —á–µ—Ä–µ–∑ `jest.unmock()`.

#### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã –∑–∞—Å–æ—Ä–µ–Ω—ã –ª–æ–≥–∞–º–∏ –æ—Ç Fastify, Winston, console.

**–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ –≤ `setupJest.ts`.

### üì¶ –¢–∏–ø—ã –º–æ–∫–æ–≤

#### 1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ (setupJest.ts)

```typescript
// –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –í–°–ï–ú —Ç–µ—Å—Ç–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
jest.mock('../src/api-client', () => ({
  /*...*/
}));
jest.mock('../src/logger', () => ({
  /*...*/
}));
jest.mock('../src/api/plugins/database', () => ({
  /*...*/
}));
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –î–ª—è –±–∞–∑–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –≤–µ–∑–¥–µ.

#### 2. –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ (–≤ —Ñ–∞–π–ª–∞—Ö —Ç–µ—Å—Ç–æ–≤)

```typescript
// API —Ç–µ—Å—Ç—ã - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏
jest.mock('../../src/api/services/cartApiService', () => ({
  CartApiService: jest.fn().mockImplementation(() => ({
    getCart: jest.fn().mockResolvedValue({ items: [], total: 0 }),
    // ...
  })),
}));
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –î–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ API routes.

#### 3. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –º–æ–∫–æ–≤

```typescript
// Unit —Ç–µ—Å—Ç—ã - –æ—Ç–∫–ª—é—á–∞–µ–º –º–µ—à–∞—é—â–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏
jest.unmock('../../src/api-client');

// –ú–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ —á—Ç–æ –Ω—É–∂–Ω–æ
jest.mock('axios');
const mockedAxios = axios as jest.Mocked<typeof axios>;
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –î–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üõ£Ô∏è API Route —Ç–µ—Å—Ç—ã (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ)

**–¶–µ–ª—å:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å HTTP endpoints —Ü–µ–ª–∏–∫–æ–º

**–ü–æ–¥—Ö–æ–¥:**

- –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–π Fastify —Å–µ—Ä–≤–µ—Ä
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –¢–µ—Å—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ `server.inject()`

**–ü—Ä–∏–º–µ—Ä:**

```typescript
import { buildServer } from '../../src/api/server';

// –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
jest.mock('../../src/api/services/cartApiService', () => ({
  /*...*/
}));

describe('Cart API Routes', () => {
  let server: any;

  beforeAll(async () => {
    server = await buildServer();
    await server.ready();
  });

  afterAll(async () => {
    await server.close();
  });

  it('should validate userId parameter', async () => {
    const response = await server.inject({
      method: 'GET',
      url: '/api/cart/invalid',
    });

    expect(response.statusCode).toBe(400);
  });
});
```

### üîß Unit —Ç–µ—Å—Ç—ã (–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

**–¶–µ–ª—å:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã/—Ñ—É–Ω–∫—Ü–∏–∏

**–ü–æ–¥—Ö–æ–¥:**

- –û—Ç–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏
- –ú–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ

**–ü—Ä–∏–º–µ—Ä:**

```typescript
// –û—Ç–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–æ–∫
jest.unmock('../../src/api-client');

// –ú–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ axios
jest.mock('axios');
const mockedAxios = axios as jest.Mocked<typeof axios>;

describe('BotApiClient', () => {
  let client: BotApiClient;

  beforeEach(() => {
    jest.clearAllMocks();
    // –ú–æ–∫ –¥–ª—è axios.create
    mockedAxios.create.mockReturnValue(mockAxiosInstance);
    client = new BotApiClient();
  });

  it('should create axios instance with config', () => {
    expect(mockedAxios.create).toHaveBeenCalledWith({
      baseURL: 'http://localhost:3000/api',
      timeout: 5000,
    });
  });
});
```

### üìã Component —Ç–µ—Å—Ç—ã (–û—Å–Ω–æ–≤–Ω—ã–µ)

**–¶–µ–ª—å:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å bot handlers, services, utilities

**–ü–æ–¥—Ö–æ–¥:**

- –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –∫–∞–∫ –µ—Å—Ç—å
- –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–æ–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –§–æ–∫—É—Å –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ

**–ü—Ä–∏–º–µ—Ä:**

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –∏–∑ setupJest.ts
// –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

describe('Cart Service', () => {
  it('should add item to cart', async () => {
    // –¢–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    await cartService.addToCart(123, menuItem, 2);
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É
  });
});
```

## üìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞

–¢–µ—Å—Ç—ã –∑–∞—Å–æ—Ä—è–ª–∏—Å—å –ª–æ–≥–∞–º–∏ –æ—Ç:

- Fastify —Å–µ—Ä–≤–µ—Ä–∞ (HTTP –∑–∞–ø—Ä–æ—Å—ã)
- Winston –ª–æ–≥–≥–µ—Ä–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏)
- Console.log/warn/error (–æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
- ts-jest –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ –≤ setupJest.ts

```typescript
// –ü–æ–¥–∞–≤–ª—è–µ–º console.warn –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
const originalWarn = console.warn;
console.warn = (...args: any[]) => {
  const message = args[0]?.toString?.() || '';
  if (
    message.includes('ts-jest') ||
    message.includes('deprecated') ||
    message.includes('isolatedModules')
  ) {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏ –Ω–∞—à–µ–≥–æ –ª–æ–≥–≥–µ—Ä–∞ –∏–ª–∏ –ø—Ä–∏ DEBUG_TESTS
  if (message.includes('WARN [') || process.env.DEBUG_TESTS) {
    originalWarn.apply(console, args);
    return;
  }

  originalWarn.apply(console, args);
};
```

### –ö–æ–Ω—Ç—Ä–æ–ª—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –¢–∏—Ö–∏–π —Ä–µ–∂–∏–º (–º–∏–Ω–∏–º—É–º –ª–æ–≥–æ–≤)
npm run test:quiet

# –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∂–∏–º (–≤—Å–µ –ª–æ–≥–∏)
npm run test:verbose

# –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º (–º–∞–∫—Å–∏–º—É–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
npm run test:debug
```

## üìä –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
npm test                    # –í—Å–µ —Ç–µ—Å—Ç—ã
npm run test:coverage       # –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
npm run test:watch          # –í —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
npm run test:api            # –¢–æ–ª—å–∫–æ API —Ç–µ—Å—Ç—ã
```

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã

```bash
npm run test:quiet          # –ú–∏–Ω–∏–º—É–º –ª–æ–≥–æ–≤
npm run test:verbose        # –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
npm run test:debug          # –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º (DEBUG_TESTS=1)
```

### –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```bash
# –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
npm test cart.test.ts

# –° –æ—Ç–ª–∞–¥–∫–æ–π
DEBUG_TESTS=1 npm test cart.test.ts

# –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ç–µ—Å—Ç
npm test -- --testNamePattern="should add item"
```

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### 1. API Route —Ç–µ—Å—Ç

```typescript
// __tests__/api/new-endpoint.test.ts

// –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
jest.mock('../../src/api/services/newService', () => ({
  NewService: jest.fn().mockImplementation(() => ({
    method: jest.fn().mockResolvedValue({}),
  })),
}));

jest.mock('../../src/api/plugins/database', () => ({
  __esModule: true,
  default: jest.fn().mockImplementation(async (fastify: any) => {
    fastify.decorate('db', mockPool);
    return Promise.resolve();
  }),
}));

jest.mock('../../src/logger', () => ({
  createLogger: jest.fn(() => ({
    info: jest.fn(),
    error: jest.fn(),
  })),
}));

import { buildServer } from '../../src/api/server';

describe('New Endpoint API Tests', () => {
  let server: any;

  beforeAll(async () => {
    server = await buildServer();
    await server.ready();
  });

  afterAll(async () => {
    await server.close();
  });

  // –í–∞—à–∏ —Ç–µ—Å—Ç—ã
});
```

### 2. Unit —Ç–µ—Å—Ç

```typescript
// __tests__/unit/new-component.test.ts

// –û—Ç–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –µ—Å–ª–∏ –º–µ—à–∞—é—Ç
jest.unmock('../../src/target-module');

// –ú–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
jest.mock('../../src/external-dependency', () => ({
  ExternalClass: jest.fn(),
}));

describe('NewComponent', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  // –í–∞—à–∏ —Ç–µ—Å—Ç—ã
});
```

### 3. Component —Ç–µ—Å—Ç

```typescript
// __tests__/new-component.test.ts

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

describe('NewComponent', () => {
  // –í–∞—à–∏ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–∫–∏
});
```

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç—ã –≤–∏—Å—è—Ç –∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**

- –û—Ç–∫—Ä—ã—Ç—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
- –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ HTTP —Å–µ—Ä–≤–µ—Ä—ã
- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã

**–†–µ—à–µ–Ω–∏—è:**

```typescript
afterAll(async () => {
  await server.close();
  // –û—á–∏—Å—Ç–∏—Ç–µ —Ä–µ—Å—É—Ä—Å—ã
});

afterEach(() => {
  jest.clearAllTimers();
  jest.useRealTimers();
});
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**

- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–∫–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–º–ø–æ—Ä—Ç–∞

**–†–µ—à–µ–Ω–∏—è:**

```typescript
// –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –º–æ–¥—É–ª—è
beforeEach(() => {
  delete require.cache[require.resolve('../../src/module')];
  const module = await import('../../src/module');
});

// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –º–æ–∫–∞
jest.unmock('../../src/module');

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –º–æ–∫–æ–≤
beforeEach(() => {
  jest.clearAllMocks();
});
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–≥–æ –ª–æ–≥–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏—è:**

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º
npm run test:quiet

# –ò–ª–∏ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
DEBUG_TESTS=0 npm test
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ TypeScript

**–†–µ—à–µ–Ω–∏—è:**

```typescript
// –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–∫–∏
const mockedAxios = axios as jest.Mocked<typeof axios>;

// –ú–æ–∫–∏ —Å —è–≤–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
jest.mock('module', (): typeof import('module') => ({
  function: jest.fn(),
}));
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 227
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:** 81.7%
- **API Routes:** 40.79% –ø–æ–∫—Ä—ã—Ç–∏—è
- **Core Components:** 85%+ –ø–æ–∫—Ä—ã—Ç–∏—è

### –¶–µ–ª–∏

- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** >85%
- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** 100%
- **API Routes:** >60%
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** <30 —Å–µ–∫—É–Ω–¥

## üîÑ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ª—É—á—à–µ–Ω–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- ‚úÖ –£–±—Ä–∞–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤
- ‚úÖ –†–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ snapshot —Ç–µ—Å—Ç—ã
- [ ] Performance —Ç–µ—Å—Ç—ã
- [ ] E2E —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram API
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [Fastify Testing](https://www.fastify.io/docs/latest/Guides/Testing/)
- [TypeScript Jest](https://jestjs.io/docs/getting-started#using-typescript)

---

**–ü–æ–º–Ω–∏—Ç–µ:** –•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã - —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞. –°–ª–µ–¥—É–π—Ç–µ —ç—Ç–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞!
